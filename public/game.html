<!DOCTYPE html>
<html>
    <head>
        <script src="p5.min.js"></script>
        <script>
            var halfWidth = 256;
            class Cell
            {
                constructor()
                {
                    this.x = 0;
                    this.y = 0;
                    this.xVel = 0;
                    this.yVel = 0;
                }
                move()
                {
                    var angle = Math.atan2(mouseY-halfWidth,mouseX-halfWidth);
                    this.xVel = Math.cos(angle)*Math.min(1,(Math.abs(mouseX-halfWidth)/20));
                    this.yVel = Math.sin(angle)*Math.min(1,(Math.abs(mouseY-halfWidth)/20));
                    this.x += this.xVel;
                    this.y += this.yVel;
                }
                split()
                {
                    let splitCells = [this];
                    return splitCells; //temporary, could return an array with multiple cells if a split occured
                }
                draw()
                {
                    ellipse(this.x, this.y, 32, 32);
                }
            }
            class Camera
            {
                constructor()
                {
                    this.camX = 0;
                    this.camY = 0;
                }
                track(cells)
                {
                    this.camX = 0;
                    this.camY = 0;
                    for(let i = 0; i < cells.length; i++)
                    {
                        this.camX += cells[i].x;
                        this.camY += cells[i].y;
                    }
                    this.camX = -this.camX/cells.length + halfWidth;
                    this.camY = -this.camY/cells.length + halfWidth;
                    translate(this.camX,this.camY);
                }
            }
            class PetriDish //haha petri dishes hold cells
            {
                constructor()
                {
                    this.clientCells = [new Cell()]; //start out with one local cell
                    this.serverCells = [];
                }
                updateCells()
                {
                    for(let i = 0; i < this.clientCells.length; i++) //local cell movement and splitting
                    {
                        this.clientCells[i].move();
                        let splitCells = this.clientCells[i].split();
                        this.clientCells.splice(i,1);
                        this.clientCells.push(...splitCells);
                    }
                    //send any local cells to server to be saved there, recieve all cells back, draw them all here
                    //send localCells
                    //get back cells from server, add to serverCells
                    //if any client sided cells do not appear in the list that we get back from the server, those cells have died
                    var allCells = this.clientCells; //temporary, should be replaced by something getting all cells to be drawn back from the server
                    for(let i = 0; i < allCells.length; i++)
                    {
                        allCells[i].draw();
                    }
                }
            }
            var c = new Cell();
            var pd = new PetriDish();
            var cam = new Camera();
            function setup()
            {
                createCanvas(512, 512);
            }
            function draw()
            {
                background(0);
                cam.track(pd.clientCells);
                pd.updateCells();
                
                console.log("cam coords"+cam.camX+" "+cam.camY);
                console.log("cell coords"+pd.clientCells[0].x+" "+pd.clientCells[0].y);
                rect(64,64,64,64);
            }
        </script>
    </head>
    <body>

    </body>
</html>